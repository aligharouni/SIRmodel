\documentclass[12pt]{article}
\usepackage{natbib}
\usepackage{hyperref}
\usepackage{grffile}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{amssymb,amsmath,amsthm}
\usepackage{xcolor}
\usepackage{xspace}
\usepackage[nameinlink,capitalize]{cleveref}
\usepackage{cleveref}
\usepackage[margin=1in]{geometry}
\usepackage{lineno}\renewcommand\thelinenumber{\color{gray}\arabic{linenumber}}
\usepackage{pdflscape}
\usepackage{enumerate}
\usepackage{xspace}

\newcommand{\ali}[1]{\comment{magenta}{Ali}{#1}}
\newcommand{\jd}[1]{\comment{blue}{JD}{#1}}
\newcommand{\david}[1]{\comment{red}{DJDE}{#1}}
\newcommand{\bmb}[1]{\comment{red}{BMB}{#1}}
\newcommand{\todo}[1]{\comment{red}{TODO}{#1}}

\newcommand*\subtxt[1]{_{\textnormal{#1}}}
\DeclareRobustCommand\_{\ifmmode\expandafter\subtxt\else\textunderscore\fi}

\newcommand{\fref}[1]{Fig.~\ref{#1}}
\newcommand{\Rlogo}{R\xspace}
\newcommand{\percap}{\emph{per capita}\xspace}
\newcommand{\R}{\ensuremath{\mathcal{R}_0}}
\newcommand{\covid}{COVID-19\xspace}
\newcommand{\pro}[1][]{\ensuremath{\frac{\partial #1}{\partial \rho}}}
\newcommand\pder[2][]{\ensuremath{\frac{\partial#1}{\partial#2}}} %\pder[x]{y}
\renewcommand{\vec}[1]{\ensuremath{\mathbf{#1}}} %bold font for vector

\newcommand{\comment}{\showcomment}
\newcommand{\showcomment}[3]{\textcolor{#1}{\textbf{[#2: }\textsl{#3}\textbf{]}}}
\newcommand{\nocomment}[3]{}

\theoremstyle{definition} % amsthm only
\newtheorem{proposition}{Proposition}
\newtheorem{theorem}{Theorem}

\bibliographystyle{apalike}

\title{The analogy of the cohort-equations paradigm to the compartmental epidemic models}

\begin{document}
\maketitle
\linenumbers
%%%%%%%%%%%%%%%%%%%%
\section{Vision}
\begin{enumerate}
\item 2 frameworks of \cite{van2002reproduction}, I call it compartment framework, and \cite{champredon2018equivalence}, I call it cohort framework, can be tied together and a mechanistic approach to go from one framework to another can be constructed.

\item Having the cohort framework enables one to study the strength-like and speed-like interventions. For example in our SIR model with testing and isolation, testing susciptables is a strength-like intervention and testing the infecteds' is a speed-like intervention. \todo{more context is required here.}
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%
\section{Math foundation}
Notation; we use $I'$ for the cohort-framework of $dI/d\tau$, where $\tau$ is in the infection-time scale and $\dot I$ for the compartment-framework of $dI/dt$. 

The matrix form of the cohort framework consists of the following 3 steps.
\begin{enumerate}[{\it Step 1.}]
\item
Form the cohort Eq. 
\begin{equation}
\label{eq:cohort}
\vec I'=-V \vec I,
\end{equation}
 with the vector of initial condition $\vec I(0)$ where $\vec I_i(0)$ be the number of infected individuals initially in compartment $i$, and $I(\tau)$ is the number of these initially infected individuals remaining in the infected compartments after $\tau$ time units.
Note that as \cite{van2002reproduction} set their formulation, 
``the $(i,j)$ entry of $F$ is the rate at which infected individuals in compartment $j$ produce new infections in compartment $i$". Matrix $V$ is the flow matrix in which the $(i,j)$ entry is the the rate of transfering infected individuals from compartment $j$ into compartment $i$, with positive (negative) means transfering out (into) a compartment.
The $(j,k)$ entry of $V^{-1}$ is the average length of time an infected individual introduced into compartment $k$ spends in compartment $j$ during its lifetime, assuming that the population remains near the DFE and barring reinfection.
Note that $V$ is a non-singular M-matrix and is, therefore, invertible and all of its eigenvalues have positive real parts \citep{van2002reproduction}.

\item 
Finding the intrinsic infectiousness kernel by integrating the cohort Eq. and solving for its time evolution, thus
the solution would be 
\begin{equation}
\label{eq:I}
\vec I(\tau) = \exp(-V\tau) \vec I(0).
\end{equation}
The kernel will be 
\begin{equation}
\label{eq:kernel}
\vec K(\tau) = F \vec I(\tau), 
\end{equation}
where $F$ is the matrix of new infections in the compartment framework.
Note that the n-by-n matrix $\exp(-V\tau)$ is the probability of being infected and stay infectious at time $\tau$. 

\item
Calculating the next-generation vector $\vec G$ is 
(\ali{feels odd here, help! $\vec G$ here is a vector with elements of the eigenvalues of the \citep{van2002reproduction}'s next-generation matrix $FV^{-1}$. 
Also check Heesterbeek work what he calls this}) 
\begin{equation}
\label{eq:ng} %next generation
\vec G = FV^{-1} = \int_0^\infty \vec K(\tau) d\tau.
\end{equation}
Note that $\R$ would be the dominant element of $\vec G$.
\end{enumerate}
Note that in the compartment framework \cite{van2002reproduction}, steps 2 and 3 are combined.

%%%%%%%%%%%%%%%%%%%%
\section{Examples}

{\bf Example 1. Simple SIR model;}
The model is
\begin{align}\label{mo:sir}
\dot S=-\beta\,S\,I/N,~~
\dot I= \beta\,S\,I/N -\gamma\,I,~~
\dot R= \gamma\,I.
\end{align}
Where $F=\beta$ and $V=\gamma$, thus $V^{-1}=1/\gamma$. The next-generation matrix $G=FV^{-1}=\beta/\gamma$ which results in $\R=\beta/\gamma$ in the compartment framework.
The cohort analogy of the simple SIR model is via the cohort Eq. with the following steps.

{\it Step 1;} The cohort Eq. $I'=-\gamma I$ with the initial condition $I(0)=1$. Thus, the solution is $I(\tau)=\exp(-\gamma \tau)$. 

{\it Step 2;} The intrinsic infectiousness kernel is given by integrating the cohort Eq. and solving for its time evolution.  Thus, $K(\tau)=F\,I(\tau)=\beta \exp(-\gamma \tau)$.

{\it Step 3;} The next-generation vector would be 
$$G=FV^{-1}=\int_0^\infty\,K(\tau)\,d\tau=\beta/\gamma.$$ This gives $\R=\beta/\gamma$. 

%%%%%%%%%
\noindent
{\bf Example 2. Simple SEIR model;}
The simplest form of a SEIR model without vital rates is 
\begin{align}\label{mo:sier1}
\dot S=-\beta\,S\,I/N,~~
\dot E= \beta\,S\,I/N -\sigma\,E,~~
\dot I= \sigma\,E -\gamma\,I,~~
\dot R= \gamma\,I.
\end{align}
We know that $\R=\beta/\gamma$ from next generation method where 

\begin{align}
\label{seir1FV}
F = \beta \left[ \begin {array}{cc} 
0 & 1 \\
0 & 0
 \end {array} \right],~~
V=
 \left[ \begin {array}{cc}
 \sigma & 0 \\
-\sigma & \gamma
\end {array} \right],
~~ \text{thus}~~
V^{-1} = \frac{1}{\sigma\,\gamma}
\left[ \begin {array}{cc}
\gamma & 0 \\
\sigma & \sigma
\end {array} \right].
\end{align}
Note that matrix $F$ determines the rate of new infections and their source. Specifically, here $F_{12}=\beta$, that is the rate of new infections in compartment $E$ is $\beta$ and it is originated from compartment $I$.  Also note that matrix $V$ determines the flow   
In the context of the cohort framework we show that the same $\R$ can be calculated by following the three steps.

{\it Step 1;} The cohort equation with the initial condition (in matrix form) is 
\begin{align}
\vec I'=-V\,\vec I,~~ \text{where}~~ \vec I(\tau)=\left[ \begin {array}{c} E(\tau)\\I(\tau) \end {array} \right], ~~
\vec I(0)=\left[ \begin {array}{c} 1\\0 \end {array} \right].
\end{align}
Solving for $I(\tau)$ by finding the eigenvalues and eigenvectors of the above linear system results in
\begin{align}
\vec I(\tau) = \left[ \begin {array}{c} E(\tau)\\I(\tau) \end {array} \right] =
\frac{\sigma}{\gamma-\sigma}\,\Big( \exp(-\sigma\,\tau)\,\left[ \begin {array}{c} \gamma/\sigma-1\\1 \end {array} \right] 
- \exp(-\gamma\,\tau)\,\left[ \begin {array}{c} 0\\1 \end {array} \right] \Big).
\end{align}

{\it Step 2;} The kernel is
\begin{align}
\vec K(\tau)= F \vec I(\tau)
= \frac{\sigma}{\gamma-\sigma} \Big(\exp(-\sigma\,\tau)\,\left[ \begin {array}{c} \beta\\0 \end {array} \right] 
 -\exp(-\gamma\,\tau)\,\left[ \begin {array}{c} \beta\\0 \end {array} \right]\Big).
\end{align}

{\it Step 3;} The next-generation vector is 
\begin{align}
\vec G=\int_0^\infty \vec K(\tau) d\tau
=\beta\,\frac{\sigma}{\gamma-\sigma}\,\Big(\left[ \begin{array}{c} 1/\sigma-1/\gamma\\0 \end{array} \right]\Big)
=\left[ \begin{array}{c} \beta/\gamma\\0 \end{array} \right].
\end{align}

%%%%%%%%%
\noindent
{\bf Example 3. SIR with testing and isolation;}
The model can be summarized in the form of following matrices.
\begin{align}
\label{FV}
F =&\beta/N_0 \left[ \begin {array}{c} S\_u^* \\ (1-\theta\_w)S\_n^* \\ 0 \\ 0 \end {array} \right]
        \left[ \begin {array}{cccc} 1, \, 1-\theta\_w, \, 1-\theta\_w, \, 1-\theta\_c \end {array} \right], \text{and}\\  
V=& \left[ \begin {array}{cccc}  
\hat F_I+\gamma&-\omega&0&0\\
0&\omega+\gamma&0&0\\
-\hat F_I&0&\omega+\gamma&0\\
0&0&-\omega&\gamma
\end {array} \right].
\end{align}

Let the test be perfectly sensative, that is $p_I=1$.

{\it Step 1;} The cohort Eq.~ is
\begin{align}
\vec I'=-V\,\vec I,~~ \text{where}~~ \vec I(\tau)=\left[ \begin {array}{c} I\_u(\tau)\\I_n(\tau)\\I_p(\tau)\\I_c(\tau) \end {array} \right], ~~
\vec I(0)=\left[ \begin {array}{c} S\_u^*\\(1-\theta\_w)S\_n^*\\0\\0 \end {array} \right].
\end{align}
Solving for $\vec I(\tau)$ by finding the eigenvalues and eigenvectors of the above linear system results in
\begin{align}
\vec I(\tau)=&
c_1\,\exp(-\gamma\,\tau)\,\left[ \begin {array}{c} 0\\0\\0\\1 \end {array} \right] 
+c_2\,\exp(-(F_I+\gamma)\,\tau)\,\left[ \begin {array}{c} \frac{F_I-\omega}{\omega}\\0\\\frac{-F_I}{\omega}\\1 \end {array} \right]
+c_3\,\exp(-(\omega+\gamma)\,\tau)\,\left[ \begin {array}{c} 0\\0\\-1\\1 \end {array} \right] \\\notag
+& c_4\,\exp(-(\omega+\gamma)\,\tau)\,\Big(\tau\,\left[ \begin {array}{c} 0\\0\\-1\\1 \end {array} \right]+
\left[ \begin {array}{c} \frac{-1}{F_I}\\ \frac{\omega-F_I}{F_I\,\omega}\\ \frac{1}{\omega}\\0 \end {array} \right]\Big),
\end{align}
where 
\begin{align}
c_1=&1\\
c_2=&\frac{\omega}{F_I-\omega}(S\_u^*-\frac{\omega}{F_I-\omega}\,S\_n^*)\\
c_3=&\frac{-F_I}{F_I-\omega}(1-\frac{\omega}{F_I-\omega}S\_n^*)\\
c_4=&\frac{-\omega\,F_I}{F_I-\omega}S\_n^*.
\end{align}

{\it Step 2;} The kernel is
\begin{align}
\vec K(\tau)= F \vec I(\tau)
\end{align}

{\it Step 3;} The next-generation vector is $\vec G$ as follows.
\begin{align}
\vec G=&\int_0^\infty \vec K(\tau) d\tau\\
=&
\end{align}
%%%%%%%%%%%%%%%%%%%%
\section{Ideas-Unknowns}
- Collapsing the vectorized kernek $\vec K(\tau)$ into a scalar function of time.

- We have 3 cases; (i) the general case where each box in $\vec I$ been pulled into others boxes of $\vec I$  (ii) simple case where we have 1 group eg. linear chain (iii) intermediate case where we have more than 1 entry point into $\vec I$ but mediated through a unitary FoI like SIR with testing. 

- SIR with testing; 

- Linear Algebra refreshing: \url{https://see.stanford.edu/materials/lsoeldsee263/11-eig.pdf}

\bibliography{SIRlibrary}
\end{document}